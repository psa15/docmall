<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.docmall.mapper.MemberMapper">
	
	<!-- 회원가입 저장 parameterType 속성은 전부 생략 가능 -->
	<insert id="join">
	
	INSERT INTO TBL_MEMBER
	    ( M_USERID, M_USERNAME, M_PASSWD, M_POSTNUM, M_ADDR, 
	    	M_ADDR_D, M_TEL, M_NICKNAME, M_EMAIL, M_EMAIL_ACCEPT )
	VALUES
	    (
	    	#{m_userid}, #{m_username}, #{m_passwd}, #{m_postnum}, #{m_addr},  
	    	#{m_addr_d}, #{m_tel}, #{m_nickname}, #{m_email}, #{m_email_accept}
	    )
	    
	</insert>
	
	<!-- 아이디 존재여부 작업(중복체크) -->
	<select id="idCheck" resultType="String">
	
		SELECT M_USERID 
		FROM TBL_MEMBER 
		WHERE M_USERID = #{m_userid}
		
	</select>
	
	<!-- 로그인 정보 인증 작업 -->
	<select id="login_ok" resultType="com.docmall.domain.MemberVO" parameterType="com.docmall.dto.LoginDTO">
		
		SELECT M_USERID, M_USERNAME, M_PASSWD, M_POSTNUM, M_ADDR, 
				M_ADDR_D, M_TEL, M_NICKNAME, M_EMAIL, M_EMAIL_ACCEPT, 
				M_POINT, M_REGDATE, M_UPDATEDATE, M_LASTDATE, M_AUTHCODE 
		FROM TBL_MEMBER 
		WHERE M_USERID = #{m_userid} <!-- 비밀번호를 암호화 하여 저장하지 않는다면 AND M_PASSWD = #{m_passwd} -->
		
	</select>
	
	<!-- 아이디 찾기 -->
	<select id="searchID" resultType="String">
		
		SELECT M_USERID
		FROM TBL_MEMBER
		WHERE M_USERNAME = #{m_username} AND M_EMAIL = #{m_email}
		
	</select>
	
	<!-- 임시 비밀번호 발급 전 아이디와 메일 존재 유무 확인 -->
	<select id="getIdEmailExists" resultType="String">
		
		SELECT M_USERID
		FROM TBL_MEMBER
		WHERE M_USERID = #{m_userid} AND M_EMAIL = #{m_email}
		
	</select>
	
	<!-- 임시비밀번호를 암호화하여 update -->
	<update id="changePw">
	
		UPDATE TBL_MEMBER
		SET M_PASSWD = #{m_passwd}
		WHERE M_USERID = #{m_userid}
	
	</update>
	
	<!-- 회원정보 수정 -->
	<update id="modify">
		
		UPDATE 
			TBL_MEMBER
		SET 
			<if test="m_passwd != null">
				M_PASSWD = #{m_passwd},
			</if>
			M_USERNAME = #{m_username},
			M_NICKNAME = #{m_nickname},
			M_POSTNUM = #{m_postnum},
			M_ADDR = #{m_addr},
			M_ADDR_D = #{m_addr_d},
			M_TEL = #{m_tel},
			M_EMAIL = #{m_email},
			M_EMAIL_ACCEPT = #{m_email_accept}
			
		WHERE 
			M_USERID = #{m_userid}
			
	</update>
</mapper>